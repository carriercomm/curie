<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Curie</title>

        <link rel="stylesheet" href="/static/css/bootstrap.css" type="text/css" media="screen" charset="utf-8">
        <link rel="stylesheet" href="/static/css/bootstrap-responsive.css" type="text/css">

        <link rel="stylesheet" href="/static/css/base.css" type="text/css" media="screen" charset="utf-8">

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

        <script src="/static/js/underscore-min.js" type="text/javascript"></script>
        <script src="/static/js/backbone-min.js" type="text/javascript"></script>

        <script src="/static/js/jsSHA/sha512.js" type="text/javascript"></script>
        <script src="/static/js/handlebars.runtime.js" type="text/javascript"></script>

        <script src="/static/js/templates.js" type="text/javascript"></script>

        <script src="/static/js/models.js" type="text/javascript"></script>
        <script src="/static/js/views.js" type="text/javascript"></script>
        <script src="/static/js/routes.js" type="text/javascript"></script>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/static/js/backbone-socketio-sync.js"></script>

    </head>
    <body>
        <div class="header">
            <img src="/static/img/curie.gif" class="logo"/><h1>Curie</h1>
            <div class="error-block" id="error-block"><span class="label label-important" id="error-message"></span></div>
        </div>

    <div class="container-fluid app">
        <div class="row-fluid">
            <div class="span3">
                <div class="sidebar-nav sidebar-nav-fixed">
                     <ul class="nav nav-list packs well" id="packList">
                     </ul>
                    <div class="muted text-center" id="lastFetchTime"></div>
                </div>
            </div>
            <script>
                window.curie = window.curie || {};

                $(function() {
                    var message = new Message({ from: 'yana.dobrunova@gmail.com', to: 'sergey@polzunov.com', subject: 'Hey, take a look at this!'});
                    //message.save();

                    var email = "some@curie.heyheylabs.com";
                    var password = "expected-password";
                    var channel = new jsSHA(email, "TEXT").getHash("SHA-512", "HEX");

                    window.curie.socket = io.connect('/stream/' + channel, {
                        secure: true,
                        port: 443,
                        query: "email=" + email + "&password=" + password,
                        'force new connection': true
                    });
                    
                    var appView = new AppView(["inbox", "sent", "facebook"]);
                    var appRouter = new AppRouter(appView);
                    window.curie.router = appRouter;


                    appView.render();

                    window.curie.socket.on('new-messages', function(data) {
                        appView.addMessage(data.message);
                    });

                    appView.fetchPacks();
                    Backbone.history.start();


                    // fetch every 10 secs
                    /*
                    setInterval(function() {
                        appView.fetchPacks();
                    }, 10 * 1000); 
                    */


                });

            </script>
            <div class="span9" id="packView">
            </div>
        </div>
    </div>

    </body>
</html>
